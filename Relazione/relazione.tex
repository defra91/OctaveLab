\documentclass[a4paper]{article}

\usepackage[utf8]{inputenc}
\usepackage{hyperref}
\usepackage{titlesec}
\usepackage[titles]{tocloft}
\usepackage{appendix}
\hypersetup{%
    pdfborder = {0 0 0}
}

\usepackage[svgnames]{xcolor} % Required to specify font color
\usepackage{listings}
\usepackage{graphicx}
\usepackage{float}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{listingsutf8}

\usepackage{chngcntr}
\counterwithin{figure}{section}

\newcommand*{\plogo}{\fbox{$\mathcal{PL}$}} % Generic publisher logo

%----------------------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------------------

\newcommand*{\titleAT}{\begingroup % Create the command for including the title page in the document
\newlength{\drop} % Command for generating a specific amount of whitespace
\drop=0.1\textheight % Define the command as 10% of the total text height

\rule{\textwidth}{1pt}\par % Thick horizontal line
\vspace{2pt}\vspace{-\baselineskip} % Whitespace between lines
\rule{\textwidth}{0.4pt}\par % Thin horizontal line

\vspace{\drop} % Whitespace between the top lines and title
\centering % Center all text
\textcolor{Black}{ % Red font color
{\Huge Laboratorio}\\[0.5\baselineskip] % Title line 1
{\Large di}\\[0.75\baselineskip] % Title line 2
{\Huge Calcolo Numerico}} % Title line 3

\vspace{0.25\drop} % Whitespace between the title and short horizontal line
\rule{0.3\textwidth}{0.4pt}\par % Short horizontal line under the title
\vspace{\drop} % Whitespace between the thin horizontal line and the author name

{\Large Luca De Franceschi}\par % Author name

\vfill % Whitespace between the author name and publisher text
{\large Universit√† degli studi di Padova}\par % Publisher

\vspace*{\drop} % Whitespace under the publisher text

\rule{\textwidth}{0.4pt}\par % Thin horizontal line
\vspace{2pt}\vspace{-\baselineskip} % Whitespace between lines
\rule{\textwidth}{1pt}\par % Thick horizontal line

\endgroup}

\titleformat{\chapter}[display]
{}{\hfill\rule{.7\textwidth}{3pt}}{2pt}
{\hspace*{.3\textwidth}\huge\bfseries}[\addvspace{1pt}]
\titleformat{name=\chapter,numberless}[display]
{}{\hfill\rule{.7\textwidth}{3pt}}{2pt}
{\hspace*{.3\textwidth}\huge\bfseries}[\addvspace{1pt}]

\renewcommand*\contentsname{Indice}
\renewcommand{\figurename}{Figura}

\newcommand{\glossario}[1]{\textit{#1\ped{\ped{G}}}}

\lstset{inputencoding=utf8/latin1}

\definecolor{light-gray}{gray}{0.95}

\lstdefinestyle{customat}{
  belowcaptionskip=1\baselineskip,
  breaklines=true,
  frame=shadowbox,
  numbers=left,
  xleftmargin=\parindent,
  language=Matlab,
  showstringspaces=false,
  basicstyle=\fontfamily{georgia}\selectfont\footnotesize\color{black},
  keywordstyle=\bfseries\color{green!40!black},
  commentstyle= \color{gray},
  identifierstyle=\color{blue},
  stringstyle=\color{orange},
  tabsize=2,
  numberstyle=\tiny
}

\renewcommand{\lstlistingname}{Listato}
\renewcommand{\lstlistlistingname}{Elenco dei listati}
\renewcommand{\listfigurename}{Elenco delle figure}

\pagestyle{headings}

\AtBeginDocument{%
  \renewcommand{\thelstlisting}{%
    \ifnum\value{subsection}=0
      \thesection.\arabic{lstlisting}%
    \else
      \ifnum\value{subsubsection}=0
        \thesection.\arabic{lstlisting}%
      \else
      \thesubsubsection%
      \fi
    \fi
  }
}

%----------------------------------------------------------------------------------------
%	BLANK DOCUMENT
%----------------------------------------------------------------------------------------

\begin{document}
\raggedright
\titleAT % This command includes the title page
\thispagestyle{empty}
\newpage

\pagenumbering{arabic}

\tableofcontents
\clearpage

\lstlistoflistings
\listoffigures
\clearpage

\input{esercitazione1}
\newpage
\input{esercitazione2}
\newpage
\input{esercitazione3}
\newpage
\input{esercitazione4}

\end{document}